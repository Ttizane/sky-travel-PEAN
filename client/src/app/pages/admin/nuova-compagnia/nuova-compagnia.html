@if (isOpen) {
<div class="modal modal-open">
	<!-- Popup overlay above the create-company modal -->
	@if (popup.visible) {
		<div class="fixed inset-0 z-[120] flex items-center justify-center pointer-events-none bg-black/20 backdrop-blur-sm">
			<div class="w-full max-w-xl mx-auto px-6 pointer-events-auto">
				<div
					class="rounded-2xl border shadow-2xl transition-all p-6 flex flex-col gap-3"
					[ngClass]="{
						'bg-blue-50 border-blue-200': popup.type === 'info',
						'bg-yellow-50 border-yellow-200': popup.type === 'warning',
						'bg-green-50 border-green-200': popup.type === 'success',
						'bg-red-50 border-red-200': popup.type === 'error'
					}"
					role="alert"
					aria-live="assertive">
					<div class="flex items-center justify-between gap-4">
						<h3 class="font-bold text-lg"
								[ngClass]="{
									'text-blue-800': popup.type === 'info',
									'text-yellow-800': popup.type === 'warning',
									'text-green-800': popup.type === 'success',
									'text-red-800': popup.type === 'error'
								}">{{ getPopupTitle() }}</h3>
					</div>
					<div class="flex justify-between items-center gap-6">
						<div class="text-base font-medium"
								 [ngClass]="{
									 'text-blue-800': popup.type === 'info',
									 'text-yellow-800': popup.type === 'warning',
									 'text-green-800': popup.type === 'success',
									 'text-red-800': popup.type === 'error'
								 }">{{ popup.message }}</div>
						<button type="button" class="btn btn-sm rounded-xl"
										(click)="closePopup()"
										[ngClass]="{
											'bg-blue-600 text-white hover:bg-blue-700 border-blue-600': popup.type === 'info',
											'bg-yellow-600 text-white hover:bg-yellow-700 border-yellow-600': popup.type === 'warning',
											'bg-green-600 text-white hover:bg-green-700 border-green-600': popup.type === 'success',
											'bg-red-600 text-white hover:bg-red-700 border-red-600': popup.type === 'error'
										}" aria-label="Chiudi avviso">OK</button>
					</div>
				</div>
			</div>
		</div>
	}

	<div class="modal-box w-11/12 max-w-2xl modal-form-container bg-white border-2 border-blue-200 rounded-2xl shadow-2xl relative">
		<h3 class="text-2xl font-bold text-blue-900 mb-2">Registra nuova compagnia</h3>
		<p class="text-blue-600 mb-6">Inserisci le informazioni per creare l'account della compagnia</p>

		<form autocomplete="off" class="grid grid-cols-1 gap-4" (submit)="$event.preventDefault()">
			<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
				<div class="form-control">
					<label class="label"><span class="label-text text-blue-800 font-semibold">Email *</span></label>
					<input type="email" name="company_email" autocomplete="off" autocapitalize="none" spellcheck="false" inputmode="email" [value]="email" (input)="email = $any($event.target).value" placeholder="es. company@example.com" class="input w-full bg-white border-2 border-blue-200 focus:border-blue-400 hover:border-blue-300 rounded-xl focus:outline-none text-blue-800 placeholder-blue-400" required />
				</div>
				<div class="form-control">
					<label class="label"><span class="label-text text-blue-800 font-semibold">Password *</span></label>
					<input type="password" name="company_password" autocomplete="new-password" [value]="password" (input)="password = $any($event.target).value" placeholder="Minimo 6 caratteri" class="input w-full bg-white border-2 border-blue-200 focus:border-blue-400 hover:border-blue-300 rounded-xl focus:outline-none text-blue-800 placeholder-blue-400" minlength="6" required />
				</div>
			</div>

			<div class="form-control">
				<label class="label"><span class="label-text text-blue-800 font-semibold">Logo/Immagine *</span></label>
				<div class="flex flex-col md:flex-row md:items-end gap-3">
					<input type="file" accept="image/*" autocomplete="off" class="file-input flex-1 bg-white border-2 border-blue-200 focus:border-blue-400 hover:border-blue-300 rounded-xl focus:outline-none text-blue-800" (change)="onLogoSelected($event)" />
					<button type="button" class="btn bg-blue-600 hover:bg-blue-700 text-white border-0 shadow-lg" (click)="onCreateClick()" [disabled]="submitting">Aggiungi</button>
				</div>

				@if (logoPreview) {
					<div class="mt-3 flex items-center gap-3">
						<img [src]="logoPreview" alt="Anteprima logo" class="w-20 h-20 object-cover rounded-xl border border-blue-200" />
						<button type="button" class="btn btn-xs bg-blue-50 text-blue-700 border border-blue-200 hover:bg-blue-100" (click)="logoFile=null; logoPreview=null">Rimuovi</button>
					</div>
				}
			</div>
		</form>

		
	</div>
	<div class="modal-backdrop bg-black/40" (click)="close()"></div>
</div>
}
