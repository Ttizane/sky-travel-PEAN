<div class="container mx-auto p-4 md:p-6 mt-4">
  @if (isOpenPopup) {
  <app-popup [message]="popupMessage" [type]="popupType" (onClose)="closePopup()"></app-popup>
}

  <!-- Header -->
  <div class="bg-white shadow-2xl mb-6 border border-blue-100 rounded-2xl">
    <div class="card-body p-8">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
        <div>
          <h1 class="text-4xl font-bold mb-3 text-blue-900">Selezione Posti</h1>
          <!-- Timer -->
           @if (timerAlreadyStarted) {
            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-xl text-sm font-semibold"
               [ngClass]="{
                 'bg-green-50 text-green-700 border border-green-200': remainingSeconds > 5*60,
                 'bg-yellow-50 text-yellow-800 border border-yellow-200': remainingSeconds <= 5*60 && remainingSeconds > 60,
                 'bg-red-50 text-red-700 border border-red-200 animate-pulse': remainingSeconds <= 60
               }">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-4">
                <path fill-rule="evenodd" d="M12 2.25a9.75 9.75 0 1 0 9.75 9.75A9.762 9.762 0 0 0 12 2.25Zm.75 4.5a.75.75 0 0 0-1.5 0v6a.75.75 0 0 0 .44.68l4.5 2a.75.75 0 1 0 .62-1.36l-4.06-1.8V6.75Z" clip-rule="evenodd" />
              </svg>
              <span>Tempo residuo: {{ remainingMinutesText }}</span>
            </div>
           }
          <div class="text-xl text-blue-600 font-medium">
            @if (currentSegment) {
              <span class="font-bold">{{ currentSegment.volo.numero }}</span> • 
              {{ currentSegment.volo.partenza }} → {{ currentSegment.volo.arrivo }} • {{ modelloConfigurazione?.nome }}
            }
          </div>
          @if (segmentPosition.total > 1) {
            <div class="text-sm text-blue-500">
              Prenotazione {{ segmentPosition.index + 1 }} di {{ segmentPosition.total }}
              @if (currentSegment) {
                @if (hasBothDirections) {
                    <span class="ml-2 inline-flex items-center gap-1 text-xs font-semibold px-2 py-0.5 rounded-full border"
                          [class.bg-blue-50]="currentSegment.direction === 'andata'"
                          [class.text-blue-700]="currentSegment.direction === 'andata'"
                          [class.border-blue-300]="currentSegment.direction === 'andata'"
                          [class.bg-blue-50]="currentSegment.direction === 'ritorno'"
                          [class.text-blue-700]="currentSegment.direction === 'ritorno'"
                          [class.border-blue-300]="currentSegment.direction === 'ritorno'">
                      {{ currentSegment.direction === 'andata' ? 'Andata' : 'Ritorno' }}
                    </span>
                }
              }
            </div>
          }
          <div class="text-lg text-blue-700 font-medium mt-2">
            Passeggeri: {{ numeroPasseggeri }} • Posti richiesti: {{ requiredSeats }}
            @if (selectedSeats.length > 0) {
              • Selezionati: {{ selectedSeats.length }}/{{ requiredSeats }}
            }
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Barra di progressione processo acquisto -->
  <div class="mb-6">
    <div class="bg-white shadow-lg border border-blue-200 rounded-xl">
      <div class="card-body p-6">
        <h3 class="text-xl font-semibold mb-6 text-center text-blue-800">Processo di Prenotazione</h3>
        
        <!-- Versione Desktop -->
        <div class="hidden md:block">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center">
              <div class="w-10 h-10 rounded-full bg-blue-700 text-white flex items-center justify-center text-sm font-semibold">1</div>
              <span class="ml-3 text-base font-medium text-blue-700">Ricerca Voli</span>
            </div>
            <div class="flex-1 mx-6">
              <div class="w-full bg-blue-100 rounded-full h-2">
                <div class="bg-blue-700 h-2 rounded-full w-full transition-all duration-500"></div>
              </div>
            </div>
            <div class="flex items-center">
              <div class="w-10 h-10 rounded-full flex items-center justify-center text-sm font-semibold"
                   [class.bg-blue-700]="getSeatFlowProgress() === 100"
                   [class.bg-blue-200]="getSeatFlowProgress() < 100"
                   [class.text-white]="getSeatFlowProgress() === 100"
                   [class.text-blue-600]="getSeatFlowProgress() < 100">2</div>
              <span class="ml-3 text-base"
                    [class.text-blue-700]="getSeatFlowProgress() === 100"
                    [class.text-blue-600]="getSeatFlowProgress() < 100"
                    [class.font-medium]="getSeatFlowProgress() === 100">Selezione Posti</span>
            </div>
            <div class="flex-1 mx-6">
              <div class="w-full bg-blue-100 rounded-full h-2">
                <div class="h-2 rounded-full transition-all duration-500" 
                     [class.bg-blue-700]="getSeatFlowProgress() === 100"
                     [class.bg-blue-200]="getSeatFlowProgress() < 100" 
                     [style.width]="getSeatFlowProgress() + '%'"></div>
              </div>
            </div>
            <div class="flex items-center">
              <div class="w-10 h-10 rounded-full bg-blue-200 text-blue-600 flex items-center justify-center text-sm font-semibold">3</div>
              <span class="ml-3 text-base text-blue-600">Check-out</span>
            </div>
          </div>
        </div>

        <!-- Versione Mobile -->
        <div class="block md:hidden">
          <div class="flex justify-center space-x-8">
            <div class="flex flex-col items-center">
              <div class="w-10 h-10 rounded-full bg-blue-700 text-white flex items-center justify-center text-sm font-semibold">1</div>
              <span class="text-sm text-blue-700 mt-2 font-medium">Ricerca</span>
            </div>
            <div class="flex flex-col items-center">
              <div class="w-10 h-10 rounded-full flex items-center justify-center text-sm font-semibold"
                   [class.bg-blue-700]="getSeatFlowProgress() === 100"
                   [class.bg-blue-200]="getSeatFlowProgress() < 100"
                   [class.text-white]="getSeatFlowProgress() === 100"
                   [class.text-blue-600]="getSeatFlowProgress() < 100">2</div>
              <span class="text-sm mt-2"
                    [class.text-blue-700]="getSeatFlowProgress() === 100"
                    [class.text-blue-600]="getSeatFlowProgress() < 100"
                    [class.font-medium]="getSeatFlowProgress() === 100">Posti</span>
            </div>
            <div class="flex flex-col items-center">
              <div class="w-10 h-10 rounded-full bg-blue-200 text-blue-600 flex items-center justify-center text-sm font-semibold">3</div>
              <span class="text-sm mt-2 text-blue-600">Check-out</span>
            </div>
          </div>
        </div>

        <!-- Indicatori di stato -->
        <div class="mt-6 text-center">
          <div class="flex justify-center space-x-6 text-sm">
            <div class="flex items-center space-x-2">
              <div class="w-3 h-3 rounded-full bg-blue-700"></div>
              <span class="text-blue-700 font-medium">In corso</span>
            </div>
            <div class="flex items-center space-x-2">
              <div class="w-3 h-3 rounded-full bg-blue-200"></div>
              <span class="text-blue-600">Da completare</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 xl:grid-cols-5 gap-6">
    <!-- Floating timer badge on large screens -->
    <div class="hidden xl:block fixed top-4 right-4 z-30">
      <div class="px-4 py-2 rounded-2xl shadow-xl border text-sm font-bold"
           [ngClass]="{
             'bg-green-600 text-white border-green-700': remainingSeconds > 5*60,
             'bg-yellow-500 text-white border-yellow-600': remainingSeconds <= 5*60 && remainingSeconds > 60,
             'bg-red-600 text-white border-red-700 animate-pulse': remainingSeconds <= 60
           }">
        ⏳ {{ remainingMinutesText }}
      </div>
    </div>
    <!-- Seat Map -->
    <div class="xl:col-span-3">
      <div class="bg-white shadow-2xl border border-blue-100 rounded-2xl">
        <div class="card-body p-8">
          
          <!-- Passenger Selection Info -->
          <div class="mb-6 p-4 bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl border border-blue-200">
            <div class="flex items-center justify-between">
              <div>
                <h3 class="text-lg font-bold text-blue-900">Selezione Posti</h3>
                <p class="text-sm text-blue-700">
                  Seleziona {{ requiredSeats }} posto/i per {{ numeroPasseggeri }} passeggero/i
                </p>
              </div>
              <div class="text-right">
                <div class="text-2xl font-bold text-blue-800">{{ selectedSeats.length }}/{{ requiredSeats }}</div>
                <div class="text-sm text-blue-600">Selezionati</div>
              </div>
            </div>
            @if (selectedSeats.length < requiredSeats) {
              <div class="mt-3 p-3 bg-blue-200 rounded-lg">
                <p class="text-sm font-medium text-blue-800">
                  <svg class="inline w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                  </svg>
                  Seleziona ancora {{ requiredSeats - selectedSeats.length }} posto/i per continuare
                </p>
              </div>
            } @else if (selectedSeats.length === requiredSeats) {
              <div class="mt-3 p-3 bg-green-200 rounded-lg">
                <p class="text-sm font-medium text-green-800">
                  <svg class="inline w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                  </svg>
                  Perfetto! Tutti i posti richiesti sono stati selezionati
                </p>
              </div>
            }
          </div>

          <!-- Legend -->
          <div class="flex flex-wrap gap-4 mb-8 p-6 bg-blue-50 rounded-2xl border border-blue-100">
            <!-- Legenda colori -->
            <div class="flex items-center gap-3">
              <div class="w-7 h-7 bg-green-500 rounded-lg border border-green-600 shadow-sm"></div>
              <span class="text-sm font-medium text-green-700">Economy</span>
            </div>
            <div class="flex items-center gap-3">
              <div class="w-7 h-7 bg-blue-600 rounded-lg border border-blue-700 shadow-sm"></div>
              <span class="text-sm font-medium text-blue-700">Business</span>
            </div>
            <div class="flex items-center gap-3">
              <div class="w-7 h-7 bg-red-500 rounded-lg border border-red-600 shadow-sm"></div>
              <span class="text-sm font-medium text-red-700">First Class</span>
            </div>
            <div class="flex items-center gap-3">
              <div class="w-7 h-7 bg-gray-400 rounded-lg border border-gray-500 shadow-sm"></div>
              <span class="text-sm font-medium text-gray-700">Occupato</span>
            </div>
            <div class="flex items-center gap-3">
              <div class="w-7 h-7 bg-blue-300 rounded-lg border border-blue-400 ring-2 ring-blue-200 shadow-sm"></div>
              <span class="text-sm font-medium text-blue-600">Selezionato</span>
            </div>
            
            <!-- Separatore visivo -->
            <div class="w-full border-t border-blue-200 my-3"></div>
            
            <!-- Statistiche -->
            <div class="flex items-center gap-3 min-w-[140px]">
              <div class="w-7 h-7 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-blue-600">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z" />
                </svg>
              </div>
              <span class="text-sm font-medium text-blue-800">
                <span class="font-semibold">Totali: </span> 
                <span class="font-bold">{{ getTotalSeats() }}</span>
              </span>
            </div>
            
            <div class="flex items-center gap-3 min-w-[140px]">
              <div class="w-7 h-7 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-green-600">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                </svg>
              </div>
              <span class="text-sm font-medium text-green-800">
                <span class="font-semibold">Disponibili: </span> 
                <span class="font-bold text-green-600">{{ getAvailableSeats() }}</span>
              </span>
            </div>
          </div>

          <!-- Seat Layout -->
          <div class="relative mx-auto">

            <!-- First Class Section -->
            @if (getFirstSeats() > 0) {
              <div class="mb-8 relative">
                <div class="flex justify-center mb-4">
                  <div class="text-center text-sm font-semibold text-white bg-red-600 py-2 px-4 rounded-xl border border-red-700 shadow-xl">
                    First Class
                  </div>
                </div>
                <div class="flex justify-center">
                  <div class="inline-block">
                    @for (rowNum of getRowsForClass('first'); track rowNum) {
                      <div class="grid gap-2 mb-3 justify-items-center items-center" [style.grid-template-columns]="getGridTemplate('first')">
                        @for (seat of getSeatsForRow('first', rowNum); track $index) {
                          @if (seat) {
                            <button 
                              [class]="getSeatClass(seat)"
                              (click)="selectSeat(seat)"
                              [disabled]="seat.status === 'occupied'"
                              class="w-8 h-8 rounded-lg border-2 text-xs font-bold transition-all duration-300 hover:scale-110 flex-shrink-0 shadow-lg">
                              {{ seat.number }}
                            </button>
                          } @else {
                            <div class="w-full"></div>
                          }
                        }
                      </div>
                    }
                  </div>
                </div>
              </div>
            }

            <!-- Business Class Section -->
            @if (getBusinessSeats() > 0) {
              <div class="mb-8 relative">
                <div class="flex justify-center mb-4">
                  <div class="text-center text-sm font-semibold text-white bg-blue-600 py-2 px-4 rounded-xl border border-blue-700 shadow-xl">
                    Business Class
                  </div>
                </div>
                <div class="flex justify-center">
                  <div class="inline-block">
                    @for (rowNum of getRowsForClass('business'); track rowNum) {
                      <div class="grid gap-2 mb-3 justify-items-center items-center" [style.grid-template-columns]="getGridTemplate('business')">
                        @for (seat of getSeatsForRow('business', rowNum); track $index) {
                          @if (seat) {
                            <button 
                              [class]="getSeatClass(seat)"
                              (click)="selectSeat(seat)"
                              [disabled]="seat.status === 'occupied'"
                              class="w-8 h-8 rounded-lg border-2 text-xs font-bold transition-all duration-300 hover:scale-110 flex-shrink-0 shadow-lg">
                              {{ seat.number }}
                            </button>
                          } @else {
                            <div class="w-full"></div>
                          }
                        }
                      </div>
                    }
                  </div>
                </div>
              </div>
            }

            <!-- Economy Class Section -->
            <div class="mb-8 relative">
              <div class="flex justify-center mb-4">
                <div class="text-center text-sm font-semibold text-white bg-green-600 py-2 px-4 rounded-xl border border-green-700 shadow-xl">
                  Economy Class
                </div>
              </div>
              <div class="flex justify-center">
                <div class="inline-block">
                  @for (rowNum of getRowsForClass('economy'); track rowNum) {
                    <div class="grid gap-2 mb-3 justify-items-center items-center" [style.grid-template-columns]="getGridTemplate('economy')">
                      @for (seat of getSeatsForRow('economy', rowNum); track $index) {
                        @if (seat) {
                          <button 
                            [class]="getSeatClass(seat)"
                            (click)="selectSeat(seat)"
                            [disabled]="seat.status === 'occupied'"
                            class="w-8 h-8 rounded-lg border-2 text-xs font-bold transition-all duration-300 hover:scale-110 flex-shrink-0 shadow-lg">
                            {{ seat.number }}
                          </button>
                        } @else {
                          <div class="w-full"></div>
                        }
                      }
                    </div>
                  }
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Seat Selection Info -->
    <div class="xl:col-span-2 space-y-6 sticky top-4 self-start max-h-screen overflow-y-auto">
      <!-- Selected Seats Management -->
      <div class="bg-white shadow-2xl border border-blue-100 rounded-2xl">
        <div class="card-body p-8">
          
          @if (selectedSeats.length > 0) {
            <div class="space-y-4">
              <!-- Lista posti selezionati -->
              @for (seat of selectedSeats; track $index) {
                <div 
                    class="border-2 rounded-2xl p-4 lg:p-5 shadow-lg transition-all duration-300 hover:shadow-xl"
                    [class.border-red-300]="seat.class === 'first'"
                    [class.bg-red-50]="seat.class === 'first'"
                    [class.border-blue-300]="seat.class === 'business'"
                    [class.bg-blue-50]="seat.class === 'business'"
                    [class.border-green-300]="seat.class === 'economy'"
                    [class.bg-green-50]="seat.class === 'economy'">
            
                  <div class="flex justify-between items-start mb-4">
                    <div class="flex items-center gap-3">
                      <span class="font-bold text-lg lg:text-xl seat-label"
                            [class.text-red-700]="seat.class === 'first'"
                            [class.text-blue-700]="seat.class === 'business'"
                            [class.text-green-700]="seat.class === 'economy'">{{ seat.number }}</span>
                      <span class="badge text-white text-xs px-3 py-1 rounded-full font-semibold shadow-sm"
                            [class.bg-red-600]="seat.class === 'first'"
                            [class.bg-blue-600]="seat.class === 'business'"
                            [class.bg-green-600]="seat.class === 'economy'">
                        {{ seat.class === 'first' ? 'First' : 
                          seat.class === 'business' ? 'Business' : 'Economy' }}
                      </span>
                    </div>
                    <button class="btn btn-ghost btn-xs text-gray-500 hover:text-red-600 hover:bg-red-50 transition-all duration-200 rounded-xl" (click)="removeSeat(seat.number)">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                      </svg>
                    </button>
                  </div>
                  
                  <!-- Assegnazione passeggero -->
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div class="form-control">
                      <label class="label label-text-alt font-semibold text-sm"
                            [class.text-red-700]="seat.class === 'first'"
                            [class.text-blue-700]="seat.class === 'business'"
                            [class.text-green-700]="seat.class === 'economy'">Passeggero</label>
                      <select
                              class="select select-bordered select-sm w-full font-semibold transition-colors"
                              [ngClass]="{
                                'bg-red-50 border-red-400 text-red-800 focus:border-red-500 focus:ring-2 focus:ring-red-200': seat.class === 'first',
                                'bg-blue-50 border-blue-400 text-blue-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200': seat.class === 'business',
                                'bg-green-50 border-green-400 text-green-800 focus:border-green-500 focus:ring-2 focus:ring-green-200': seat.class === 'economy'
                              }"
                              [ngModel]="seat.passengerIndex"
                              (ngModelChange)="setSeatPassenger(seat, $event)">
                        <option [ngValue]="undefined" disabled>Seleziona passeggero</option>
                        @for (p of passengers; track $index) {
                          <option [ngValue]="$index">
                            {{ p.firstName }} {{ p.lastName }} ({{ p.dateOfBirth | date:'dd/MM/yyyy' }})
                          </option>
                        }
                      </select>
                    </div>
                    <div class="form-control">
                      <label class="label label-text-alt font-semibold text-sm"
                            [class.text-red-700]="seat.class === 'first'"
                            [class.text-blue-700]="seat.class === 'business'"
                            [class.text-green-700]="seat.class === 'economy'" >Tipo posto</label>
                      <input
                        class="input input-bordered input-sm font-semibold cursor-text transition-colors"
                        [ngClass]="{
                          'bg-red-50 border-red-400 text-red-800 focus:border-red-500 focus:ring-2 focus:ring-red-200': seat.class === 'first',
                          'bg-blue-50 border-blue-400 text-blue-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200': seat.class === 'business',
                          'bg-green-50 border-green-400 text-green-800 focus:border-green-500 focus:ring-2 focus:ring-green-200': seat.class === 'economy'
                        }"
                        [value]="getSeatType(seat.number)"
                        readonly
                        aria-readonly="true"
                      />
                    </div>
                  </div>
                  
                  <!-- Costi posto -->
                  <div class="flex justify-between text-sm lg:text-base mt-4 pt-4 border-t-2"
                      [class.border-red-200]="seat.class === 'first'"
                      [class.border-blue-200]="seat.class === 'business'"
                      [class.border-green-200]="seat.class === 'economy'">
                    <span class="font-semibold"
                          [class.text-red-700]="seat.class === 'first'"
                          [class.text-blue-700]="seat.class === 'business'"
                          [class.text-green-700]="seat.class === 'economy'">Posto {{ seat.number }}:</span>
                    <span class="font-bold text-lg"
                          [class.text-red-600]="seat.class === 'first'"
                          [class.text-blue-600]="seat.class === 'business'"
                          [class.text-green-600]="seat.class === 'economy'">€{{ getSeatPrice(seat) }}</span>
                  </div>
                  @if (seat.passengerIndex !== undefined && passengers[seat.passengerIndex!].extraBags! > 0) {
                    <div class="flex justify-between text-sm lg:text-base">
                      <span class="font-medium text-gray-600">Bagagli ({{ passengers[seat.passengerIndex!].extraBags }}):</span>
                      <span class="font-bold text-orange-600">€{{ passengers[seat.passengerIndex!].extraBags! * getBagPrice() }}</span>
                    </div>
                  }
                </div>
              }
              
              <!-- Riepilogo totale - Layout compatto -->
              <div class="bg-gradient-to-r from-blue-100 to-blue-200 border-2 border-blue-300 rounded-2xl p-4 lg:p-5 shadow-lg">
                <div class="flex justify-between items-center mb-2">
                  <span class="font-bold text-blue-800 text-lg lg:text-xl">Totale:</span>
                  <span class="text-2xl lg:text-3xl font-black text-blue-600">€{{ currentBooking.totalPrice }}</span>
                </div>
                <div class="text-sm lg:text-base text-blue-700 font-medium">
                  {{ selectedSeats.length }} posto/i
                </div>
              </div>
              
              <div class="flex flex-col lg:flex-row gap-3">
                <button 
                  class="btn btn-primary flex-1 bg-blue-700 hover:bg-blue-800 border-blue-700 text-white font-bold text-base shadow-xl transition-all duration-300 hover:shadow-2xl rounded-xl" 
                  [disabled]="!isBookingValid()"
                  (click)="confirmBooking()">
                  @if (selectedSeats.length === requiredSeats && isBookingValid()) {
                    {{ (segmentPosition.index + 1) < segmentPosition.total ? 'Conferma' : 'Procedi al Checkout' }}
                  } @else if (selectedSeats.length < requiredSeats) {
                    Seleziona {{ requiredSeats - selectedSeats.length }} posto/i
                  } @else {
                    Assegna ogni posto
                  }
                </button>
                <button class="btn btn-outline border-gray-400 text-gray-600 hover:bg-gray-100 hover:border-gray-500 font-semibold rounded-xl transition-all duration-200" (click)="clearAllSelections()">
                  Annulla Tutto
                </button>
              </div>
            </div>
          } @else {
            <div class="text-center py-8 lg:py-12 text-base-content/60">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-18 text-blue-300 mx-auto mb-4">
                <path d="M11.644 1.59a.75.75 0 0 1 .712 0l9.75 5.25a.75.75 0 0 1 0 1.32l-9.75 5.25a.75.75 0 0 1-.712 0l-9.75-5.25a.75.75 0 0 1 0-1.32l9.75-5.25Z" />
                <path d="m3.265 10.602 7.668 4.129a2.25 2.25 0 0 0 2.134 0l7.668-4.13 1.37.739a.75.75 0 0 1 0 1.32l-9.75 5.25a.75.75 0 0 1-.71 0l-9.75-5.25a.75.75 0 0 1 0-1.32l1.37-.738Z" />
                <path d="m10.933 19.231-7.668-4.13-1.37.739a.75.75 0 0 0 0 1.32l9.75 5.25c.221.12.489.12.71 0l9.75-5.25a.75.75 0 0 0 0-1.32l-1.37-.738-7.668 4.13a2.25 2.25 0 0 1-2.134-.001Z" />
              </svg>
              <p class="text-blue-600 text-lg lg:text-xl font-semibold">Seleziona uno o più posti dalla mappa</p>
              <p class="text-blue-500 text-sm lg:text-base mt-2">Clicca sui posti disponibili per iniziare la prenotazione</p>
            </div>
          }
        </div>
      </div>    
    </div>
  </div>
</div>
